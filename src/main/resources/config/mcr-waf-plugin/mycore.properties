
# MyCoRe WAF Plugin Configuration
MCR.Startup.Class=%MCR.Startup.Class%,org.mycore.waf.FilterRegistrationStartupHandler


##############################################################################
# MyCore WAF Plugin Configuration
##############################################################################

# Enable or disable the WAF
# Default: true
#MCR.WAF.Enabled=true

##############################################################################
# Allow Lists - Skip WAF checks for trusted sources
##############################################################################

# IP Allow List (comma-separated, supports CIDR notation)
# Example: MCR.WAF.AllowedIPs=127.0.0.1,192.168.1.0/24,10.0.0.1
#MCR.WAF.AllowedIPs=

# Path Allow List (comma-separated regex patterns)
# Example: MCR.WAF.AllowedPaths=/api/public/.*,/health,/metrics
# standard paths for bots to access without WAF checks
MCR.WAF.AllowedPaths=/robots.txt,/sitemap.xml,/favicon.ico

# known mycore api paths that bots may need to access without WAF checks
MCR.WAF.AllowedPaths=%MCR.WAF.AllowedPaths%,\
/api/.*,\
/servlets/OAIDataProvider.*,\
/servlets/MCRDFGServlet/*,\
/servlets/MCRDFGThumbnail/*

##############################################################################
# Known Bot Verification via Reverse DNS
#
# The following two properties work together: a reverse DNS check is ONLY
# performed if the request's User-Agent first matches one of the known bot
# User-Agent patterns (MCR.WAF.KnownBotUserAgents). If the User-Agent matches,
# the resolved hostname is verified against the DNS patterns
# (MCR.WAF.KnownBotReverseDNS) to confirm the bot's identity.
##############################################################################

# Known bot User-Agent patterns (comma-separated, case-insensitive substring match)
# Only requests whose User-Agent contains one of these strings trigger a reverse DNS check.

# https://developers.google.com/crawling/docs/crawlers-fetchers/google-common-crawlers
# Common crawlers (reverse DNS: *.googlebot.com)
MCR.WAF.KnownBotUserAgents=\
Googlebot,\
GoogleOther,\
Storebot-Google,\
Google-InspectionTool,\
Google-CloudVertexBot,\
Google-Extended

# https://developers.google.com/crawling/docs/crawlers-fetchers/google-special-case-crawlers
# Special-case crawlers (reverse DNS: rate-limited-proxy-*.google.com)
MCR.WAF.KnownBotUserAgents=%MCR.WAF.KnownBotUserAgents%,\
AdsBot-Google,\
AdsBot-Google-Mobile,\
Mediapartners-Google,\
APIs-Google,\
Google-Safety

# https://developers.google.com/crawling/docs/crawlers-fetchers/google-user-triggered-fetchers
# User-triggered fetchers (reverse DNS: *.gae.googleusercontent.com, google-proxy-*.google.com)
MCR.WAF.KnownBotUserAgents=%MCR.WAF.KnownBotUserAgents%,\
FeedFetcher-Google,\
GoogleMessages,\
Google-NotebookLM,\
Google-Pinpoint,\
GoogleProducer,\
Google-Read-Aloud,\
Google-Site-Verification,\
Google-CWS

# https://blogs.bing.com/webmaster/August-2012/How-to-Verify-that-Bingbot-is-Bingbot
# https://www.bing.com/webmasters/help/how-to-verify-bingbot-3905dc26
MCR.WAF.KnownBotUserAgents=%MCR.WAF.KnownBotUserAgents%,\
bingbot,\
msnbot

# https://www.baidu.com/search/spider_japan.html
MCR.WAF.KnownBotUserAgents=%MCR.WAF.KnownBotUserAgents%,\
Baiduspider

# https://support.apple.com/de-de/119829
MCR.WAF.KnownBotUserAgents=%MCR.WAF.KnownBotUserAgents%,\
Applebot

# Known bot reverse DNS patterns (comma-separated patterns with wildcards).
# These hostname patterns are verified via reverse + forward DNS lookup,
# but only if the User-Agent was already identified as a known bot above.

# https://developers.google.com/crawling/docs/crawlers-fetchers/verify-google-requests?hl=de
MCR.WAF.KnownBotReverseDNS=\
crawl-*.googlebot.com,\
*-crawl-*.googlebot.com,\
*.geo.googlebot.com,\
rate-limited-proxy-*.google.com,\
*.gae.googleusercontent.com,\
google-proxy-*.google.com

# https://blogs.bing.com/webmaster/August-2012/How-to-Verify-that-Bingbot-is-Bingbot
MCR.WAF.KnownBotReverseDNS=%MCR.WAF.KnownBotReverseDNS%,\
msnbot-*-*-*-*.search.msn.com

# https://www.baidu.com/search/spider_japan.html
MCR.WAF.KnownBotReverseDNS=%MCR.WAF.KnownBotReverseDNS%,\
baiduspider-*-*-*-*.crawl.baidu.com,\
BaiduMobaider-*-*-*-*.crawl.baidu.jp

# https://support.apple.com/de-de/119829
MCR.WAF.KnownBotReverseDNS=%MCR.WAF.KnownBotReverseDNS%,\
*-*-*-*.applebot.apple.com

# https://www.bing.com/webmasters/help/how-to-verify-bingbot-3905dc26
MCR.WAF.KnownBotReverseDNS=%MCR.WAF.KnownBotReverseDNS%,\
*search.msn.com



# Enable Forward DNS Verification (recommended for security)
# Verifies that the reverse DNS hostname resolves back to the original IP
# This prevents DNS spoofing attacks
# Default: true
MCR.WAF.VerifyReverseDNS=true


##############################################################################
# Reverse DNS Cache Settings
##############################################################################

# Maximum number of IPs to keep in the reverse DNS cache
# Default: 1000
#MCR.WAF.DNSCacheCapacity=1000

# How long a resolved hostname stays valid in the cache (in minutes)
# After this time the DNS lookup is repeated for that IP
# Default: 60
#MCR.WAF.DNSCacheTTLMinutes=60

##############################################################################
# Proof of Work Challenge Settings
##############################################################################

# Maximum number of failed attempts before showing failure page
# Default: 3
#MCR.WAF.MaxAttempts=3

# PoW Difficulty (number of leading zero bits required in hash)
# Higher values = harder challenge, longer solve time
# Default: 16 (approximately 1-5 seconds on modern browsers)
#MCR.WAF.Difficulty=16

# Challenge token expiry in minutes (how long the PoW challenge is valid)
# Default: 2
#MCR.WAF.ChallengeExpiryMinutes=2

# WAF-PASSED token expiry in minutes (how long a solved challenge grants access)
# Default: 1440 (1 day)
#MCR.WAF.PassedTokenExpiryMinutes=1440

##############################################################################
# HTML Template Configuration
##############################################################################

# Classpath path to the challenge page HTML template
# Default: pow-challenge.html
#MCR.WAF.ChallengeHtml=pow-challenge.html

# Classpath path to the failure page HTML template
# Default: pow-challenge-fail.html
#MCR.WAF.ChallengeFailHtml=pow-challenge-fail.html

# Classpath path to the challenge page JavaScript
# Injected into the HTML template via the {{pow_challenge_script}} placeholder
# Default: pow-challenge.js
#MCR.WAF.ChallengeScript=pow-challenge.js
