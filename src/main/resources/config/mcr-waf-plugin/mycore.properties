
# MyCoRe WAF Plugin Configuration
MCR.Startup.Class=%MCR.Startup.Class%,org.mycore.waf.FilterRegistrationStartupHandler


##############################################################################
# MyCore WAF Plugin Configuration
##############################################################################

# Enable or disable the WAF
# Default: true
#MCR.WAF.Enabled=true

##############################################################################
# Allow Lists - Skip WAF checks for trusted sources
##############################################################################

# IP Allow List (comma-separated, supports CIDR notation)
# Example: MCR.WAF.AllowedIPs=127.0.0.1,192.168.1.0/24,10.0.0.1
#MCR.WAF.AllowedIPs=

# Path Allow List (comma-separated regex patterns)
# Example: MCR.WAF.AllowedPaths=/api/public/.*,/health,/metrics
# standard paths for bots to access without WAF checks
MCR.WAF.AllowedPaths=/robots.txt,/sitemap.xml,/favicon.ico

# known mycore api paths that bots may need to access without WAF checks
MCR.WAF.AllowedPaths=%MCR.WAF.AllowedPaths%,\
/api/.*,\
/servlets/OAIDataProvider.*,\
/servlets/MCRDFGServlet/*,\
/servlets/MCRDFGThumbnail/*

# Reverse DNS Allow List (comma-separated patterns with wildcards)
# Patterns for Google Crawlers (verified by reverse + forward DNS):

# https://developers.google.com/crawling/docs/crawlers-fetchers/verify-google-requests?hl=de
MCR.WAF.AllowedReverseDNS=\
crawl-*.googlebot.com,\
*-crawl-*.googlebot.com,\
*.geo.googlebot.com,\
rate-limited-proxy-*.google.com,\
*.gae.googleusercontent.com,\
google-proxy-*.google.com

# https://blogs.bing.com/webmaster/August-2012/How-to-Verify-that-Bingbot-is-Bingbot
MCR.WAF.AllowedReverseDNS=%MCR.WAF.AllowedReverseDNS%,\
msnbot-*-*-*-*.search.msn.com

# https://www.baidu.com/search/spider_japan.html
MCR.WAF.AllowedReverseDNS=%MCR.WAF.AllowedReverseDNS%,\
baiduspider-*-*-*-*.crawl.baidu.com,\
BaiduMobaider-*-*-*-*.crawl.baidu.jp

# https://support.apple.com/de-de/119829
MCR.WAF.AllowedReverseDNS=%MCR.WAF.AllowedReverseDNS%,\
*-*-*-*.applebot.apple.com

# https://www.bing.com/webmasters/help/how-to-verify-bingbot-3905dc26
MCR.WAF.AllowedReverseDNS=%MCR.WAF.AllowedReverseDNS%,\
*search.msn.com



# Enable Forward DNS Verification (recommended for security)
# Verifies that the reverse DNS hostname resolves back to the original IP
# This prevents DNS spoofing attacks
# Default: true
MCR.WAF.VerifyReverseDNS=true


##############################################################################
# Reverse DNS Cache Settings
##############################################################################

# Maximum number of IPs to keep in the reverse DNS cache
# Default: 1000
#MCR.WAF.DNSCacheCapacity=1000

# How long a resolved hostname stays valid in the cache (in minutes)
# After this time the DNS lookup is repeated for that IP
# Default: 60
#MCR.WAF.DNSCacheTTLMinutes=60

##############################################################################
# Proof of Work Challenge Settings
##############################################################################

# Maximum number of failed attempts before showing failure page
# Default: 3
#MCR.WAF.MaxAttempts=3

# PoW Difficulty (number of leading zero bits required in hash)
# Higher values = harder challenge, longer solve time
# Default: 16 (approximately 1-5 seconds on modern browsers)
#MCR.WAF.Difficulty=16

# Challenge token expiry in minutes (how long the PoW challenge is valid)
# Default: 2
#MCR.WAF.ChallengeExpiryMinutes=2

# WAF-PASSED token expiry in minutes (how long a solved challenge grants access)
# Default: 1440 (1 day)
#MCR.WAF.PassedTokenExpiryMinutes=1440

##############################################################################
# HTML Template Configuration
##############################################################################

# Classpath path to the challenge page HTML template
# Default: pow-challenge.html
#MCR.WAF.ChallengeHtml=pow-challenge.html

# Classpath path to the failure page HTML template
# Default: pow-challenge-fail.html
#MCR.WAF.ChallengeFailHtml=pow-challenge-fail.html

# Classpath path to the challenge page JavaScript
# Injected into the HTML template via the {{pow_challenge_script}} placeholder
# Default: pow-challenge.js
#MCR.WAF.ChallengeScript=pow-challenge.js
